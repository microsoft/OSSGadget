// Copyright (c) Microsoft Corporation. Licensed under the MIT License.

namespace Microsoft.CST.OpenSource.FindSquats.Mutators
{
    using Microsoft.CST.OpenSource.Helpers;
    using System.Collections.Generic;

    /// <summary>
    /// Generates Unicode homoglyphs.
    /// Similar looking letters were swapped out for similar looking unicode characters.
    /// e.g. ['a'] = "Î±Ğ°âºï½ğšğ‘ğ’‚ğ’¶ğ“ªğ”ğ•’ğ–†ğ–ºğ—®ğ˜¢ğ™–ğšŠğ›‚ğ›¼ğœ¶ğ°ğª";
    /// </summary>
    public class UnicodeHomoglyphMutator : IMutator
    {
        public MutatorType Kind { get; } = MutatorType.UnicodeHomoglyph;

        private static readonly Dictionary<char, string> homoglyphs = new()
        {
            ['a'] = "Î±Ğ°âºï½ğšğ‘ğ’‚ğ’¶ğ“ªğ”ğ•’ğ–†ğ–ºğ—®ğ˜¢ğ™–ğšŠğ›‚ğ›¼ğœ¶ğ°ğª",
            ['b'] = "Æ„Ğ¬áá–¯ï½‚ğ›ğ‘ğ’ƒğ’·ğ“«ğ”Ÿğ•“ğ–‡ğ–»ğ—¯ğ˜£ğ™—ğš‹",
            ['c'] = "Ï²Ñá´„â…½â²¥ê®¯ï½ƒğ½ğœğ‘ğ’„ğ’¸ğ“¬ğ” ğ•”ğ–ˆğ–¼ğ—°ğ˜¤ğ™˜ğšŒ",
            ['d'] = "Ôá§á‘¯â…†â…¾ê“’ï½„ğğ‘‘ğ’…ğ’¹ğ“­ğ”¡ğ••ğ–‰ğ–½ğ—±ğ˜¥ğ™™ğš",
            ['e'] = "ĞµÒ½â„®â„¯â…‡ê¬²ï½…ğğ‘’ğ’†ğ“®ğ”¢ğ•–ğ–Šğ–¾ğ—²ğ˜¦ğ™šğš",
            ['f'] = "Å¿ÏÖ„áºê™ê¬µï½†ğŸğ‘“ğ’‡ğ’»ğ“¯ğ”£ğ•—ğ–‹ğ–¿ğ—³ğ˜§ğ™›ğšğŸ‹",
            ['g'] = "ÆÉ¡Öá¶ƒâ„Šï½‡ğ ğ‘”ğ’ˆğ“°ğ”¤ğ•˜ğ–Œğ—€ğ—´ğ˜¨ğ™œğš",
            ['h'] = "Ò»Õ°á‚â„ï½ˆğ¡ğ’‰ğ’½ğ“±ğ”¥ğ•™ğ–ğ—ğ—µğ˜©ğ™ğš‘",
            ['i'] = "Ä±É©ÉªË›ÍºÎ¹Ñ–Óá¥á¾¾â„¹â…ˆâ…°â³ê™‡ê­µï½‰ğ‘£ƒğ¢ğ‘–ğ’Šğ’¾ğ“²ğ”¦ğ•šğ–ğ—‚ğ—¶ğ˜ªğ™ğš’ğš¤ğ›Šğœ„ğœ¾ğ¸ğ²",
            ['j'] = "Ï³Ñ˜â…‰ï½Šğ£ğ‘—ğ’‹ğ’¿ğ“³ğ”§ğ•›ğ–ğ—ƒğ—·ğ˜«ğ™Ÿğš“",
            ['k'] = "ï½‹ğ¤ğ‘˜ğ’Œğ“€ğ“´ğ”¨ğ•œğ–ğ—„ğ—¸ğ˜¬ğ™ ğš”",
            ['m'] = "ï½",
            ['n'] = "Õ¸Õ¼ï½ğ§ğ‘›ğ’ğ“ƒğ“·ğ”«ğ•Ÿğ–“ğ—‡ğ—»ğ˜¯ğ™£ğš—",
            ['p'] = "ÏÏ±Ñ€â´â²£ï½ğ©ğ‘ğ’‘ğ“…ğ“¹ğ”­ğ•¡ğ–•ğ—‰ğ—½ğ˜±ğ™¥ğš™ğ›’ğ› ğœŒğœšğ†ğ”ğ€ğğºğŸˆ",
            ['q'] = "Ô›Õ£Õ¦ï½‘ğªğ‘ğ’’ğ“†ğ“ºğ”®ğ•¢ğ––ğ—Šğ—¾ğ˜²ğ™¦ğšš",
            ['r'] = "Ğ³á´¦â²…ê­‡ê­ˆê®ï½’ğ«ğ‘Ÿğ’“ğ“‡ğ“»ğ”¯ğ•£ğ–—ğ—‹ğ—¿ğ˜³ğ™§ğš›",
            ['s'] = "Æ½Ñ•êœ±ê®ªï½“ğ‘ˆğ‘£ğ¬ğ‘ ğ’”ğ“ˆğ“¼ğ”°ğ•¤ğ–˜ğ—Œğ˜€ğ˜´ğ™¨ğšœ",
            ['t'] = "ï½”ğ­ğ‘¡ğ’•ğ“‰ğ“½ğ”±ğ•¥ğ–™ğ—ğ˜ğ˜µğ™©ğš",
            ['u'] = "Ê‹Ï…Õ½á´œêŸê­ê­’ï½•ğ“¶ğ‘£˜ğ®ğ‘¢ğ’–ğ“Šğ“¾ğ”²ğ•¦ğ–šğ—ğ˜‚ğ˜¶ğ™ªğšğ›–ğœğŠğ„ğ¾",
            ['v'] = "Î½Ñµ×˜á´ â…´âˆ¨â‹ê®©ï½–ğ‘œ†ğ‘£€ğ¯ğ‘£ğ’—ğ“‹ğ“¿ğ”³ğ•§ğ–›ğ—ğ˜ƒğ˜·ğ™«ğšŸğ›ğœˆğ‚ğ¼ğ¶",
            ['w'] = "É¯Ñ¡ÔÕ¡á´¡ê®ƒï½—ğ‘œŠğ‘œğ‘œğ°ğ‘¤ğ’˜ğ“Œğ”€ğ”´ğ•¨ğ–œğ—ğ˜„ğ˜¸ğ™¬ğš ğª",
            ['x'] = "Ã—Ñ…á•á•½á™®â…¹â¤«â¤¬â¨¯ï½˜ğ±ğ‘¥ğ’™ğ“ğ”ğ”µğ•©ğ–ğ—‘ğ˜…ğ˜¹ğ™­ğš¡",
            ['y'] = "É£ÊÎ³ÑƒÒ¯áƒ§á¶Œá»¿â„½ê­šï½™ğ‘£œğ²ğ‘¦ğ’šğ“ğ”‚ğ”¶ğ•ªğ–ğ—’ğ˜†ğ˜ºğ™®ğš¢ğ›„ğ›¾ğœ¸ğ²ğ¬",
            ['z'] = "á´¢ê®“ï½šğ‘£„ğ³ğ‘§ğ’›ğ“ğ”ƒğ”·ğ•«ğ–Ÿğ—“ğ˜‡ğ˜»ğ™¯ğš£",
            ['~'] = "Ëœá¿€â“âˆ¼",
            ['.'] = "É‘Î±Ğ°âºï½ğšğ‘ğ’‚ğ’¶ğ“ªğ”ğ•’ğ–†ğ–ºğ—®ğ˜¢ğ™–ğšŠğ›‚ğ›¼ğœ¶ğ°ğª",
            ['_'] = "ßºï¹ï¹ï¹ï¼¿",
            ['-'] = "Ë‰â€¾â–”ï¹‰ï¹Šï¹‹ï¹Œï¿£",
        };

        public IEnumerable<Mutation> Generate(string arg)
        {
            // assumption is that attacker is making just one change
            for (int i = 0; i < arg.Length; i++)
            {
                if (homoglyphs.ContainsKey(arg[i]))
                {
                    foreach (char c in homoglyphs[arg[i]])
                    {
                        yield return new Mutation(
                            mutated: arg.ReplaceCharAtPosition(c, i),
                            original: arg,
                            mutator: Kind,
                            reason: $"Unicode Homoglyph: {arg[i]} => {c}");
                    }
                }
            }
        }
    }
}